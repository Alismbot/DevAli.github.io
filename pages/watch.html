<div class="watch-container">
    <h1 id="series-title"></h1>

    <div class="video-feed" id="video-feed">
        <!-- videos auto insert -->
    </div>

    <div class="side-buttons">
        <button id="like-btn">â¤ï¸</button>
        <button id="episodes-btn">ğŸ“º</button>
        <button id="share-btn">ğŸ”—</button>
    </div>
</div>

<style>
.watch-container {
    position: relative;
    width: 100%;
    height: 100vh;
    background: #000;
    overflow: hidden;
    color: #fff;
}

/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
#series-title {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 22px;
    z-index: 10;
}

/* Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø¹Ø§Ù…ÙˆØ¯ÙŠ */
.video-feed {
    width: 100%;
    height: 100vh;
    overflow-y: scroll;
    scroll-snap-type: y mandatory;
    scroll-behavior: smooth;     /* Ø£Ù‡Ù… Ø®Ø· */
}

/* Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¹Ù†ØµØ± ÙˆØ§Ø­Ø¯ */
.video-feed > div {
    width: 100%;
    height: 100vh;
    scroll-snap-align: start;
    position: relative;
}

/* Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
.video-feed video {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Ø£Ø²Ø±Ø§Ø± Ø¬Ø§Ù†Ø¨ÙŠØ© */
.side-buttons {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 15px;
    z-index: 20;
}
</style>

<script>
// Ù‚Ø±Ø§Ø¡Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ù„Ø³Ù„
const params = new URLSearchParams(window.location.search);
const seriesName = params.get("series") || "loveblack";
document.getElementById("series-title").innerText = seriesName;

// Ø±ÙˆØ§Ø¨Ø· RAW
const episodes = [
    `https://raw.githubusercontent.com/Alismbot/DevAli.github.io/main/assets/series/${seriesName}/ep1.mp4`,
    `https://raw.githubusercontent.com/Alismbot/DevAli.github.io/main/assets/series/${seriesName}/ep2.mp4`,
    `https://raw.githubusercontent.com/Alismbot/DevAli.github.io/main/assets/series/${seriesName}/ep3.mp4`
];

const feed = document.getElementById("video-feed");

// Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¯Ø§Ø®Ù„ DIV Ù„ÙƒÙ„ Ø­Ù„Ù‚Ø©
episodes.forEach(url => {
    const wrap = document.createElement("div");
    const vid = document.createElement("video");
    vid.src = url;
    vid.controls = false;
    vid.autoplay = false;
    vid.loop = false;

    wrap.appendChild(vid);
    feed.appendChild(wrap);
});

// Ù†Ø¸Ø§Ù… scroll snap Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ
let currentIndex = 0;
let allowSnap = true;

feed.addEventListener("scroll", () => {
    if (!allowSnap) return;

    clearTimeout(feed.snapTimeout);

    feed.snapTimeout = setTimeout(() => {
        const vh = window.innerHeight;
        const newIndex = Math.round(feed.scrollTop / vh);

        currentIndex = newIndex;
        allowSnap = false;

        feed.scrollTo({
            top: currentIndex * vh,
            behavior: "smooth"
        });

        document.querySelectorAll(".video-feed video").forEach((v, i) => {
            if (i === currentIndex) v.play();
            else {
                v.pause();
                v.currentTime = 0;
            }
        });

        setTimeout(() => allowSnap = true, 350);

    }, 70);
});

// ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ ÙÙŠØ¯ÙŠÙˆ
window.onload = () => {
    const vid = document.querySelector(".video-feed video");
    if (vid) vid.play();
};
</script>
