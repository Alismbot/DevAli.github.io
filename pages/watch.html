<script>
const params = new URLSearchParams(window.location.search);
const seriesName = params.get('series') || 'loveblack';
document.getElementById('series-title').innerText = seriesName;

// استعمال GitHub RAW
const episodes = [
    'ep1.mp4',
    'ep2.mp4',
    'ep3.mp4'
];

const feed = document.getElementById('video-feed');

// إنشاء الفيديوهات
episodes.forEach(ep => {
    const video = document.createElement('video');
    video.src = `https://raw.githubusercontent.com/Alismbot/DevAli.github.io/main/assets/series/${seriesName}/${ep}`;
    video.controls = false;
    video.autoplay = false;
    video.loop = false;
    video.playsInline = true;
    video.preload = "metadata";
    feed.appendChild(video);
});

// -----------------------------------------------------------
//   1) منع تجاوز الفيديوهات أثناء السحب
// -----------------------------------------------------------
let isScrolling = false;
feed.addEventListener('scroll', () => {
    if (isScrolling) return;

    isScrolling = true;

    setTimeout(() => {
        const scrollPos = feed.scrollTop;
        const videoHeight = window.innerHeight;
        const index = Math.round(scrollPos / videoHeight);

        feed.scrollTo({
            top: index * videoHeight,
            behavior: "smooth"
        });

        isScrolling = false;
    }, 120);
});

// -----------------------------------------------------------
//   2) تشغيل فيديو واحد فقط + إيقاف الآخرين
// -----------------------------------------------------------
const observer = new IntersectionObserver(
    entries => {
        entries.forEach(entry => {
            const video = entry.target;

            if (entry.isIntersecting && entry.intersectionRatio > 0.7) {
                // تشغيل الفيديو المتواجد بأكبر نسبة داخل الشاشة
                video.play().catch(()=>{});
            } else {
                // إيقاف أي فيديو آخر
                video.pause();
                video.currentTime = 0; // يبدأ من الأول عند العودة
            }
        });
    },
    {
        threshold: [0.7]  // يجب أن يكون 70% داخل الشاشة
    }
);

document.querySelectorAll('video').forEach(v => observer.observe(v));
</script>
