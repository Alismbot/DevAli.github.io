<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Watch - WAMOD</title>
<style>
/* --- Ø¹Ø§Ù… --- */
html,body{margin:0;padding:0;height:100%;-webkit-tap-highlight-color:transparent;}
html, body { overscroll-behavior-y: contain; }

/* Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
.watch-container {
  position: relative;
  width: 100%;
  height: 100vh;
  background:#000;
  overflow: hidden;
  color:#fff;
  font-family: Arial, sans-serif;
}

/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
#series-title {
  position: absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  font-size:20px;
  z-index:30;
  pointer-events:none;
}

/* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
.video-feed {
  width:100%;
  height:100%;
  position:relative;
}

/* Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
.video-feed video {
  width:100%;
  height:100vh;
  object-fit:cover;
  position:absolute;
  top:0;
  left:0;
  display:none;
  -webkit-user-select:none;
  user-select:none;
}

/* Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ - Ù…Ø«Ù„Ø« Ø¨Ø¯ÙˆÙ† Ø®Ù„ÙÙŠØ© */
#play-btn {
  position: absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:70px;
  color: rgba(255,255,255,0.95);
  background: transparent;
  border: none;
  padding: 0;
  margin: 0;
  cursor: pointer;
  z-index:40;
  opacity: 0;
  transition: opacity .25s;
  pointer-events: none;
}

/* Ø²Ø± Ø§Ù„Ø­Ù„Ù‚Ø§Øª Ø¯Ø§Ø¦Ø±ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† ÙÙŠ Ø§Ù„ÙˆØ³Ø· */
#episodes-btn {
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  z-index:40;
  width:66px;
  height:66px;
  border-radius:50%;
  background: rgba(0,0,0,0.6);
  color: #fff;
  border: none;
  font-size:28px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition: transform .12s, background .12s, opacity .2s;
  opacity: 0;
  pointer-events: none;
}

/* Ø¹Ù†Ø¯ Ø§Ù„Ø¸Ù‡ÙˆØ± ÙŠØµØ¨Ø­ Ù…ØªØ§Ø­Ù‹Ø§ */
#episodes-btn.show { opacity: 1; pointer-events: auto; }

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ù„Ù‚Ø§Øª (Ø¹Ù„Ù‰ ÙŠØ³Ø§Ø± Ø§Ù„Ø²Ø±) */
#episodes-list {
  position: absolute;
  right: 90px;
  top: 50%;
  transform: translateY(-50%);
  z-index:45;
  background: rgba(0,0,0,0.85);
  padding:10px;
  border-radius:10px;
  display:flex;
  flex-direction: column;
  gap:8px;
  max-height:60vh;
  overflow:auto;
  display:none;
}

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… */
#episodes-list button {
  background: transparent;
  border: 1px solid rgba(255,255,255,0.08);
  color: #00e676;
  padding:8px 12px;
  font-size:16px;
  border-radius:8px;
  cursor:pointer;
  text-align:right;
}

/* Ø¥Ø¸Ù‡Ø§Ø± */
#episodes-list.show { display:flex; }

/* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø²Ø± Ø§Ù„Ø£ÙˆØ³Ø· */
#play-btn.show { opacity: 1; pointer-events: auto; }

/* Ù„Ù…Ø³Ø§Øª */
#episodes-btn:active { transform: scale(.96); }
</style>
</head>
<body>

<div class="watch-container">
  <h1 id="series-title"></h1>

  <div class="video-feed" id="video-feed"></div>

  <!-- Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ù…Ø«Ù„Ø« (Ø¨Ø¯ÙˆÙ† Ø®Ù„ÙÙŠØ©) -->
  <button id="play-btn" aria-label="Play/Pause">â–º</button>

  <!-- Ø²Ø± Ø§Ù„Ø­Ù„Ù‚Ø§Øª Ø¯Ø§Ø¦Ø±ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† -->
  <button id="episodes-btn" aria-label="Episodes">ğŸ“º</button>

  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ù„Ù‚Ø§Øª ØªØ¸Ù‡Ø± Ø¨Ø¬Ø§Ù†Ø¨Ù‡ -->
  <div id="episodes-list" aria-hidden="true"></div>
</div>

<script>
// ========================
// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³Ù„Ø³Ù„ (RAW links)
// ========================
const params = new URLSearchParams(window.location.search);
const seriesName = params.get('series') || 'loveblack';
document.getElementById('series-title').innerText = seriesName;

// Ø­Ù„Ù‚Ø§ØªÙƒ (raw links Ù…Ø¹ ?raw=1 Ù„ØªÙˆØ§ÙÙ‚ GitHub)
const episodes = [
  `https://raw.githubusercontent.com/Alismbot/DevAli.github.io/main/assets/series/${seriesName}/ep1.mp4?raw=1`,
  `https://raw.githubusercontent.com/Alismbot/DevAli.github.io/main/assets/series/${seriesName}/ep2.mp4?raw=1`,
  `https://raw.githubusercontent.com/Alismbot/DevAli.github.io/main/assets/series/${seriesName}/ep3.mp4?raw=1`
];

// Ø¹Ù†Ø§ØµØ± DOM
const feed = document.getElementById('video-feed');
const playBtn = document.getElementById('play-btn');
const episodesBtn = document.getElementById('episodes-btn');
const episodesList = document.getElementById('episodes-list');

// Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ù†Ø¹ pull-to-refresh Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ø§ÙˆÙŠØ©
document.body.addEventListener('touchmove', function(e){
  if (e.target.closest('.watch-container')) e.preventDefault();
}, { passive:false });

// ========================
// Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
// ========================
let currentIndex = 0;
const videoElements = episodes.map((url, i) => {
  const v = document.createElement('video');
  v.src = url;
  v.autoplay = false;
  v.loop = false;
  v.controls = false;
  v.playsInline = true;
  v.preload = 'metadata';
  v.style.zIndex = i === 0 ? 1 : 0;
  feed.appendChild(v);
  return v;
});

// Ø¥Ø¸Ù‡Ø§Ø± ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø£ÙˆÙ„
videoElements[0].style.display = 'block';
videoElements[0].play().catch(()=>{});

// ========================
// Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©: ØªØºÙŠÙŠØ± ÙÙŠØ¯ÙŠÙˆ
// ========================
function showVideo(index) {
  if (index < 0 || index >= videoElements.length) return;
  videoElements.forEach((vv, i) => {
    if (i === index) {
      vv.style.display = 'block';
      vv.style.zIndex = 1;
      vv.play().catch(()=>{});
    } else {
      vv.pause();
      vv.currentTime = 0;
      vv.style.display = 'none';
      vv.style.zIndex = 0;
    }
  });
  currentIndex = index;
}

// ========================
// ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
// ========================
let uiHideTimer = null;
function showUI() {
  // Ø£Ø¸Ù‡Ø± Ø§Ù„Ø²Ø±ÙŠÙ†
  playBtn.classList.add('show');
  episodesBtn.classList.add('show');
  // Ø§Ø¬Ø¹Ù„Ù‡Ù… ÙŠÙ…ÙƒÙ‘Ù†ÙˆÙ† Ø§Ù„Ù†Ù‚Ø±
  playBtn.style.pointerEvents = 'auto';
  episodesBtn.style.pointerEvents = 'auto';

  // Ø¥Ø®ÙØ§Ø¤Ù‡Ù… Ø¨Ø¹Ø¯ 2 Ø«Ø§Ù†ÙŠØ© Ø¥Ù† Ù„Ù… ØªÙÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
  clearTimeout(uiHideTimer);
  uiHideTimer = setTimeout(() => {
    if (!episodesList.classList.contains('show')) {
      playBtn.classList.remove('show');
      episodesBtn.classList.remove('show');
      playBtn.style.pointerEvents = 'none';
      episodesBtn.style.pointerEvents = 'none';
    }
  }, 2000);
}

function hideUIImmediately() {
  clearTimeout(uiHideTimer);
  playBtn.classList.remove('show');
  episodesBtn.classList.remove('show');
  playBtn.style.pointerEvents = 'none';
  episodesBtn.style.pointerEvents = 'none';
}

// Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø£Ùˆ Ø¥Ø®ÙØ§Ø¤Ù‡Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¸Ø§Ù‡Ø±Ø©
let lastTapTime = 0;
feed.addEventListener('click', (e) => {
  // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…ÙØªÙˆØ­Ø©ØŒ Ø£ØºÙ„Ù‚Ù‡Ø§ ÙˆØ§Ø¨Ù‚Ù Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¸Ø§Ù‡Ø±Ø© Ù‚Ù„ÙŠÙ„Ø§Ù‹
  if (episodesList.classList.contains('show')) {
    episodesList.classList.remove('show');
    episodesList.setAttribute('aria-hidden','true');
    showUI();
    return;
  }

  // Ø¥Ø°Ø§ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù…Ø±Ø¦ÛŒØ© Ø§Ù„Ø¢Ù†ØŒ Ø¥Ø®ÙÙÙ‡Ø§ ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ
  const now = Date.now();
  if (playBtn.classList.contains('show')) {
    // Ø¥Ø®ÙØ§Ø¡ ÙÙˆØ±ÙŠ
    hideUIImmediately();
    lastTapTime = now;
    return;
  }

  // ÙˆØ¥Ù„Ø§ØŒ Ø£Ø¸Ù‡Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
  showUI();
  lastTapTime = now;
});

// ========================
// Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
// ========================
playBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  const v = videoElements[currentIndex];
  if (v.paused) {
    v.play().catch(()=>{});
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø²Ø± Ù…Ø¨Ø§Ø´Ø±Ø© ÙƒÙ…Ø§ ÙÙŠ ØªÙŠÙƒ ØªÙˆÙƒ
    playBtn.classList.remove('show');
    playBtn.style.pointerEvents = 'none';
  } else {
    v.pause();
    // Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¸Ø§Ù‡Ø±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
    showUI();
  }
});

// ========================
// Ø²Ø± Ø§Ù„Ø­Ù„Ù‚Ø§Øª: ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØªÙˆÙ„ÙŠØ¯Ù‡Ø§
// ========================
episodesBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  if (episodesList.classList.contains('show')) {
    episodesList.classList.remove('show');
    episodesList.setAttribute('aria-hidden','true');
    // Ø§Ø®ÙØ§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± ØµØºÙŠØ±
    clearTimeout(uiHideTimer);
    uiHideTimer = setTimeout(() => hideUIImmediately(), 1000);
    return;
  }
  populateEpisodesList();
  episodesList.classList.add('show');
  episodesList.setAttribute('aria-hidden','false');
  // Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¸Ø§Ù‡Ø±Ø© Ø£Ø«Ù†Ø§Ø¡ Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
  clearTimeout(uiHideTimer);
  playBtn.classList.add('show');
  episodesBtn.classList.add('show');
  playBtn.style.pointerEvents = 'auto';
  episodesBtn.style.pointerEvents = 'auto';
});

// ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ù„Ù‚Ø§Øª ÙƒØ£Ø±Ù‚Ø§Ù…
function populateEpisodesList() {
  episodesList.innerHTML = ''; // ØªÙØ±ÙŠØº
  episodes.forEach((ep, i) => {
    const b = document.createElement('button');
    b.textContent = (i+1).toString();
    b.addEventListener('click', (ev) => {
      ev.stopPropagation();
      // Ø´ØºÙ„ Ø§Ù„Ø­Ù„Ù‚Ø© ÙÙˆØ±Ø§Ù‹
      showVideo(i);
      // ØºÙ„Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
      episodesList.classList.remove('show');
      episodesList.setAttribute('aria-hidden','true');
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø¹Ø¯ Ù„Ø­Ø¸Ø©
      clearTimeout(uiHideTimer);
      uiHideTimer = setTimeout(() => hideUIImmediately(), 800);
    });
    episodesList.appendChild(b);
  });
}

// Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† Ø¢Ø®Ø± Ù†ØºÙ„Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
document.addEventListener('click', (e) => {
  if (!e.target.closest('#episodes-list') && !e.target.closest('#episodes-btn')) {
    episodesList.classList.remove('show');
    episodesList.setAttribute('aria-hidden','true');
  }
});

// ========================
// Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø­Ø¨ (touchstart/touchend) - Ù„Ø§ Ù†ØºÙŠØ±Ù‡ (Ù…Ø¤Ù‚Øª=50px)
// ========================
let startY = 0;
feed.addEventListener('touchstart', (e) => {
  startY = e.touches[0].clientY;
}, { passive:true });

feed.addEventListener('touchend', (e) => {
  const endY = e.changedTouches[0].clientY;
  const diff = startY - endY;
  const TH = 50;
  if (Math.abs(diff) > TH) {
    if (diff > 0) {
      if (currentIndex < videoElements.length - 1) showVideo(currentIndex + 1);
    } else {
      if (currentIndex > 0) showVideo(currentIndex - 1);
    }
  }
}, { passive:true });

// Ù…Ù†Ø¹ Ø¨Ø¹Ø¶ Ø³Ù„ÙˆÙƒ Ø§Ù„Ù€pull-to-refresh ÙÙŠ Ù…ØªØµÙØ­Ø§Øª Ø¨Ø¹ÙŠÙ†Ù‡Ø§
let lastTouchY = 0;
feed.addEventListener('touchmove', (e) => {
  const ty = e.touches[0].clientY;
  const dy = Math.abs(ty - lastTouchY);
  if (dy > 2) e.preventDefault && e.preventDefault();
  lastTouchY = ty;
}, { passive:false });

</script>
</body>
</html>
