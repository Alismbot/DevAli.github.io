<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Watch - WAMOD</title>
<style>
/* Ø¹Ø§Ù… */
html,body{margin:0;padding:0;height:100%;-webkit-tap-highlight-color:transparent;}
html, body { overscroll-behavior-y: contain; } /* helps avoid pull-to-refresh */

/* Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
.watch-container {
  position: relative;
  width: 100%;
  height: 100vh;
  background:#000;
  overflow: hidden;
  color:#fff;
  font-family: Arial, sans-serif;
}

/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
#series-title {
  position: absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  font-size:20px;
  z-index:30;
  pointer-events:none;
}

/* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
.video-feed {
  width:100%;
  height:100%;
  position:relative;
}

/* Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
.video-feed video {
  width:100%;
  height:100vh;
  object-fit:cover;
  position:absolute;
  top:0;
  left:0;
  display:none;
  -webkit-user-select:none;
  user-select:none;
}

/* Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ - Ù…Ø«Ù„Ø« Ø¨Ø¯ÙˆÙ† Ø®Ù„ÙÙŠØ© */
#play-btn {
  position: absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:70px;
  color: rgba(255,255,255,0.95);
  background: transparent;
  border: none;
  padding: 0;
  margin: 0;
  cursor: pointer;
  z-index:40;
  opacity: 0;
  transition: opacity .25s;
  pointer-events: none;
}

/* Ø²Ø± Ø§Ù„Ø­Ù„Ù‚Ø§Øª Ø¯Ø§Ø¦Ø±ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† ÙÙŠ Ø§Ù„ÙˆØ³Ø· */
#episodes-btn {
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  z-index:40;
  width:66px;
  height:66px;
  border-radius:50%;
  background: rgba(0,0,0,0.6);
  color: #fff;
  border: none;
  font-size:28px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition: transform .12s, background .12s, opacity .2s;
  opacity: 0;
  pointer-events: none;
}

/* Ø¹Ù†Ø¯ Ø§Ù„Ø¸Ù‡ÙˆØ± ÙŠØµØ¨Ø­ Ù…ØªØ§Ø­Ù‹Ø§ */
#episodes-btn.show { opacity: 1; pointer-events: auto; }

/* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø²Ø± Ø§Ù„Ø£ÙˆØ³Ø· */
#play-btn.show { opacity: 1; pointer-events: auto; }

/* Bottom sheet (ÙƒÙ€ full-like ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª) */
#episodes-sheet {
  position: fixed;
  left: 0;
  right: 0;
  bottom: -100%;
  height: 90vh; /* ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ ÙŠØºØ·ÙŠ Ø§Ù„Ø´Ø§Ø´Ø© ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª (full-like) */
  background: linear-gradient(180deg, #0f0f0f, #0b0b0b);
  color: #fff;
  border-radius: 18px 18px 0 0;
  z-index: 999;
  padding: 14px;
  box-shadow: 0 -8px 40px rgba(0,0,0,0.6);
  transition: bottom .34s cubic-bezier(.2,.9,.3,1);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* ØªØ¸Ù‡Ø± */
#episodes-sheet.show { bottom: 0; }

/* Ø±Ø£Ø³ Ø§Ù„Ù„ÙˆØ­Ø© */
.sheet-top {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding-bottom:8px;
}

/* Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ØµØºÙŠØ± Ø§Ù„Ø¹Ù„ÙˆÙŠ */
.sheet-handle {
  width: 56px;
  height: 6px;
  background: rgba(255,255,255,0.12);
  border-radius: 6px;
  margin: 6px auto 0;
}

/* info */
.sheet-info {
  display:flex;
  gap:12px;
  align-items:center;
  padding: 8px 6px 0 6px;
}

.sheet-info img {
  width: 84px;
  height: 110px;
  object-fit: cover;
  border-radius: 8px;
}

.sheet-info .meta {
  display:flex;
  flex-direction:column;
  gap:6px;
}

.sheet-info h3 {
  margin:0;
  font-size:18px;
}

.sheet-info p { margin:0; color:#bfbfbf; font-size:13px; }

/* Ø§Ù„ØªØ§Ø¨Ø§Øª */
.sheet-tabs {
  display:flex;
  gap:8px;
  margin-top:10px;
  padding-left:6px;
}

.sheet-tabs button {
  background: rgba(255,255,255,0.06);
  color: #ddd;
  border: none;
  padding: 8px 12px;
  border-radius: 18px;
  cursor: pointer;
  font-size:14px;
}

.sheet-tabs button.active {
  background: #fff;
  color: #000;
  font-weight:600;
}

/* Ø§Ù„Ø¬Ø³Ù… (grid) */
.sheet-body {
  margin-top: 12px;
  padding: 0 6px 12px 6px;
  flex:1;
  overflow:auto;
}

.episodes-grid {
  display:grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 12px;
  align-items: stretch;
}

/* Ø²Ø± Ø§Ù„Ø­Ù„Ù‚Ø© */
.episode-btn {
  background: linear-gradient(180deg, #1b1b1b, #151515);
  color: #fff;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.04);
  padding: 10px 6px;
  font-size: 16px;
  cursor: pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition: transform .08s ease, box-shadow .12s;
}
.episode-btn:active { transform: scale(.96); box-shadow: none; }

/* Ø²Ø± ØºÙ„Ù‚ */
#close-sheet {
  background: transparent;
  color: #ddd;
  border: none;
  font-size: 22px;
  cursor: pointer;
}

/* ØµØºÙŠØ±Ø©: Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ø³Ù‡Ù„ØªØŒ Ø§Ø¬Ø¹Ù„ feed ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù†Ù‚Ø± Ø­ØªÙ‰ Ù„Ø§ ØªØªØ¯Ø§Ø®Ù„ Ø§Ù„Ù„Ù…Ø³Ø§Øª */
.feed-blocked { pointer-events: none; }

/* responsive tweaks */
@media (max-width:420px){
  .sheet-info img { width: 72px; height: 96px; }
  .episodes-grid { grid-template-columns: repeat(4, 1fr); gap:10px; }
  #play-btn { font-size:56px; }
}
</style>
</head>
<body>
<div class="watch-container">
  <h1 id="series-title"></h1>

  <div class="video-feed" id="video-feed"></div>

  <!-- Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ù…Ø«Ù„Ø« (Ø¨Ø¯ÙˆÙ† Ø®Ù„ÙÙŠØ©) -->
  <button id="play-btn" aria-label="Play/Pause">â–º</button>

  <!-- Ø²Ø± Ø§Ù„Ø­Ù„Ù‚Ø§Øª Ø¯Ø§Ø¦Ø±ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† -->
  <button id="episodes-btn" aria-label="Episodes">ğŸ“º</button>

  <!-- Bottom Sheet Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
  <div id="episodes-sheet" aria-hidden="true">
    <div class="sheet-top">
      <div style="flex:1"></div>
      <button id="close-sheet" aria-label="Close">âœ•</button>
    </div>

    <div class="sheet-handle" aria-hidden="true"></div>

    <div class="sheet-info">
      <img id="sheet-poster" src="" alt="poster" />
      <div class="meta">
        <h3 id="sheet-title">Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ù„Ø³Ù„</h3>
        <p id="sheet-desc">ÙˆØµÙ Ø¨Ø³ÙŠØ· Ù„Ù„Ù…Ø³Ù„Ø³Ù„ (ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡)</p>
        <div class="sheet-tabs">
          <button data-tab="1" class="active">1â€“20</button>
          <button data-tab="2">21â€“40</button>
        </div>
      </div>
    </div>

    <div class="sheet-body">
      <div id="tab-1" class="episodes-grid"></div>
      <div id="tab-2" class="episodes-grid" style="display:none"></div>
    </div>
  </div>
</div>

<script>
// ---------- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³Ù„Ø³Ù„ ----------
const params = new URLSearchParams(window.location.search);
const seriesName = params.get('series') || 'loveblack';
document.getElementById('series-title').innerText = seriesName;

// Raw links Ù„Ù„Ø­Ù„Ù‚Ø§Øª (Ø§Ø³ØªØ¨Ø¯Ù„ Ø£Ùˆ Ø£Ø¨Ù‚Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ù„Ø§Ø­Ù‚Ø§Ù‹)
const episodes = [];
// Ù†Ù…Ù„Ø£ 40 Ø­Ù„Ù‚Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ (Ø³ØªØ¶Ø¹ Ø±ÙˆØ§Ø¨Ø·Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø¨Ù†ÙØ³ ØªØ±ØªÙŠØ¨ ep1..ep40)
for(let i=1;i<=40;i++){
  episodes.push(`https://raw.githubusercontent.com/Alismbot/DevAli.github.io/main/assets/series/${seriesName}/ep${i}.mp4`);
}

// ---------- Ø¹Ù†Ø§ØµØ± DOM ----------
const feed = document.getElementById('video-feed');
const playBtn = document.getElementById('play-btn');
const episodesBtn = document.getElementById('episodes-btn');
const sheet = document.getElementById('episodes-sheet');
const closeSheet = document.getElementById('close-sheet');
const tab1 = document.getElementById('tab-1');
const tab2 = document.getElementById('tab-2');
const tabs = document.querySelectorAll('.sheet-tabs button');
const sheetPoster = document.getElementById('sheet-poster');
const sheetTitle = document.getElementById('sheet-title');
const sheetDesc = document.getElementById('sheet-desc');

// Ø­Ø§ÙˆÙ„ ØªØ¹ÙŠÙŠÙ† Ø¨ÙˆØ³ØªØ± Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ù„Ùˆ Ù„Ù… ØªÙˆÙØ±)
sheetPoster.src = `https://raw.githubusercontent.com/Alismbot/DevAli.github.io/main/assets/series/${seriesName}/${seriesName}.jpg`;
sheetTitle.innerText = seriesName;
sheetDesc.innerText = `Ù…Ø´Ø§Ù‡Ø¯Ø© ${seriesName} â€” Ø­Ù„Ù‚Ø§Øª`;

// ---------- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª (ÙƒÙ…Ø§ ÙƒØ§Ù† Ø¹Ù†Ø¯Ùƒ) ----------
let currentIndex = 0;
const videoElements = episodes.map((url,i)=>{
  const v = document.createElement('video');
  v.src = url;
  v.autoplay = false;
  v.loop = false;
  v.controls = false;
  v.playsInline = true;
  v.preload = 'metadata';
  v.style.zIndex = i===0?1:0;
  feed.appendChild(v);
  return v;
});

// ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ ÙˆØ§Ø­Ø¯ Ø¥Ù† ÙˆØ¬Ø¯
if(videoElements.length>0){
  videoElements[0].style.display='block';
  videoElements[0].play().catch(()=>{});
}

// ---------- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ ----------
function showVideo(index){
  if(index<0||index>=videoElements.length) return;
  videoElements.forEach((vv,i)=>{
    if(i===index){
      vv.style.display='block';
      vv.style.zIndex=1;
      vv.play().catch(()=>{});
    } else {
      vv.pause();
      vv.currentTime = 0;
      vv.style.display='none';
      vv.style.zIndex=0;
    }
  });
  currentIndex = index;
}

// ---------- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± (show/hide) ----------
let uiHideTimer = null;
function showUI(){
  playBtn.classList.add('show');
  episodesBtn.classList.add('show');
  playBtn.style.pointerEvents = 'auto';
  episodesBtn.style.pointerEvents = 'auto';
  clearTimeout(uiHideTimer);
  uiHideTimer = setTimeout(()=>{
    if(!sheet.classList.contains('show')){
      playBtn.classList.remove('show');
      episodesBtn.classList.remove('show');
      playBtn.style.pointerEvents = 'none';
      episodesBtn.style.pointerEvents = 'none';
    }
  },2000);
}
function hideUIImmediate(){
  clearTimeout(uiHideTimer);
  playBtn.classList.remove('show');
  episodesBtn.classList.remove('show');
  playBtn.style.pointerEvents = 'none';
  episodesBtn.style.pointerEvents = 'none';
}

// Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø­Ø©
feed.addEventListener('click',(e)=>{
  if(sheet.classList.contains('show')){
    // Ø¥Ø°Ø§ Ø§Ù„sheet Ù…ÙØªÙˆØ­ØŒ Ø§ØºÙ„Ù‚Ù‡Ø§ Ø£ÙˆÙ„Ø§Ù‹ ÙˆØ§Ø¸Ù‡Ø± Ø§Ù„UI
    hideSheet();
    showUI();
    return;
  }
  if(playBtn.classList.contains('show')){
    hideUIImmediate();
    return;
  }
  showUI();
});

// Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ ÙÙŠ Ø§Ù„ÙˆØ³Ø·
playBtn.addEventListener('click',(e)=>{
  e.stopPropagation();
  const v = videoElements[currentIndex];
  if(v.paused){
    v.play().catch(()=>{});
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø²Ø± ÙÙˆØ± Ø§Ù„ØªØ´ØºÙŠÙ„
    playBtn.classList.remove('show');
    playBtn.style.pointerEvents='none';
  } else {
    v.pause();
    showUI();
  }
});

// ---------- Bottom Sheet logic ----------
function fillSheet(){
  tab1.innerHTML = '';
  tab2.innerHTML = '';
  for(let i=0;i<episodes.length;i++){
    const n = i+1;
    const btn = document.createElement('button');
    btn.className = 'episode-btn';
    btn.textContent = n;
    btn.addEventListener('click',(ev)=>{
      ev.stopPropagation();
      // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
      showVideo(i);
      hideSheet();
    });
    if(n<=20) tab1.appendChild(btn);
    else tab2.appendChild(btn);
  }
}

// ÙØªØ­ Ø§Ù„Ù€ sheet
function openSheet(){
  fillSheet();
  sheet.classList.add('show');
  sheet.setAttribute('aria-hidden','false');
  // pause current video to avoid overlapping sound while picking
  try{ videoElements[currentIndex].pause(); }catch(e){}
  // block feed interactions to avoid accidental swipes while sheet open
  feed.classList.add('feed-blocked');
}

// ØºÙ„Ù‚ Ø§Ù„Ù€ sheet
function hideSheet(){
  sheet.classList.remove('show');
  sheet.setAttribute('aria-hidden','true');
  // resume current video automatically
  try{ videoElements[currentIndex].play().catch(()=>{}); }catch(e){}
  feed.classList.remove('feed-blocked');
}

episodesBtn.addEventListener('click',(e)=>{
  e.stopPropagation();
  if(sheet.classList.contains('show')){ hideSheet(); return; }
  openSheet();
});

// close button
closeSheet.addEventListener('click', (e)=>{ e.stopPropagation(); hideSheet(); });

// tabs switching
tabs.forEach(t=>{
  t.addEventListener('click',(ev)=>{
    tabs.forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    const id = t.dataset.tab;
    if(id==='1'){ tab1.style.display='grid'; tab2.style.display='none'; }
    else { tab1.style.display='none'; tab2.style.display='grid'; }
  });
});

// click outside sheet to close
document.addEventListener('click',(e)=>{
  if(!e.target.closest('#episodes-sheet') && !e.target.closest('#episodes-btn')){
    if(sheet.classList.contains('show')) hideSheet();
  }
});

// ---------- Swipe system (touchstart/touchend) kept as-is) ----------
let startY=0;
feed.addEventListener('touchstart',(e)=>{ startY = e.touches[0].clientY; }, { passive:true });

feed.addEventListener('touchend',(e)=>{
  // if sheet is open ignore swipes for video navigation
  if(sheet.classList.contains('show')) return;
  const endY = e.changedTouches[0].clientY;
  const diff = startY - endY;
  const TH = 50;
  if(Math.abs(diff)>TH){
    if(diff>0){
      if(currentIndex < videoElements.length - 1) showVideo(currentIndex + 1);
    } else {
      if(currentIndex > 0) showVideo(currentIndex - 1);
    }
  }
}, { passive:true });

// Do not add touchmove preventDefault here to avoid breaking native scroll/pull-to-refresh.
// overscroll-behavior in CSS handles most cases.

</script>
</body>
</html>
